{
  "hash": "c171bdfd493158426ae591e3ce247785",
  "result": {
    "markdown": "# ðŸ§¹ Simple data cleaning\n\n<div class=\"tenor-gif-embed\" data-postid=\"4998775\" data-share-method=\"host\" data-aspect-ratio=\"1.39888\" data-width=\"100%\"><a href=\"https://tenor.com/view/sponge-bob-cleaning-cats-household-chores-gif-4998775\">Sponge Bob Cleaning GIF</a>from <a href=\"https://tenor.com/search/sponge+bob-gifs\">Sponge Bob GIFs</a></div> <script type=\"text/javascript\" async src=\"https://tenor.com/embed.js\"></script>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load functions\nbox::use(\n    #* For pipe operator\n    magrittr = magrittr[\n        `%>%`\n    ],\n    #* For helpful data cleaning functions\n    dplyr = dplyr[\n        select,\n        rename,\n        filter,\n        mutate,\n        case_when\n    ]\n)\n# Load data\nload(\"C:/Users/damon/Desktop/psci_2075/psci_2075_data.RData\")\n```\n:::\n\n\nFor the most part, the data in this class are quite \"clean\". However, there are circumstances where you might want to \"clean\" the variables some more. By \"clean\", I mean to make the data usable for your analysis.\n\nSo here are some quick functions that all come from the nifty `dplyr` package [@dplyr] to refer to that can help with cleaning your dataset, creating a new variable, or more.\n\n1. `select()`: for when you want to make a new dataset containing only a handful of variables from the original dataset.\n\nSay for example that I want to create a new dataset containing only the following two variables from the `nes` dataset: `vote12` and `disc_police`. What I am doing here is a different task than just grabbing a variable by doing `nes$vote12`. Here, I want to put these two variables into a new dataset. A subset of the previous dataset, if you will.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnes_subset <- nes %>% # grab the nes dataset and store the result of the following in nes_subset\n    select( # select the following columns...\n        vote12, # ...vote12...\n        disc_police # ...and disc_police\n    )\nhead(nes_subset, 5) # preview the first 5 rows of the new dataset\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 x 2\n  vote12       disc_police                    \n  <fct>        <fct>                          \n1 Barack Obama Treats whites moderately better\n2 Not asked    Treats whites a little better  \n3 Mitt Romney  Treats blacks a little better  \n4 Barack Obama Treats whites much better      \n5 Mitt Romney  Treats both the same           \n```\n:::\n:::\n\n\n2. `rename()`: for when you want to rename a variable.\n\nSay, for example, you want to rename a variable to something that makes more sense to you. In previous exercises, you've seen me use this function to rename a variable to look better for tables.\n\nSay, for example that I want to rename the variables that I have in the `nes_subset` dataset that I created earlier.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnes_renamed <- nes_subset %>% # take the nes_subset and do the following to it\n    rename(\n        `Vote for Obama` = vote12, # rename vote12 to Vote for Obama\n        `Police discrimination` = disc_police # rename disc_police to Police discrimination\n    )\n\nhead(nes_renamed, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 x 2\n  `Vote for Obama` `Police discrimination`        \n  <fct>            <fct>                          \n1 Barack Obama     Treats whites moderately better\n2 Not asked        Treats whites a little better  \n3 Mitt Romney      Treats blacks a little better  \n4 Barack Obama     Treats whites much better      \n5 Mitt Romney      Treats both the same           \n```\n:::\n:::\n\n\nNotice how I use the little accents for the new variable names. I only do this because the new variable names include spaces in it. You do not have to rename variables this way. I often recommend ***only*** doing this if you are preparing the dataset for visualization. Typically I'd refrain from doing this until you are about to make some tables and graphs and need a pretty variable name.\n\n3. `filter()`: for when you want to filter your dataset for particular cases.\n\nSay, for example, that I want to examine the connection between voting for Obama in 2012 or not and the belief that Whites are treated better by the police, but I only want to examine this connection among White respondents. I can filter the dataset to only include the cases where the respondent indicated that they were White.\n\nBeware of doing this, however. You should not go crazy with filtering out respondents. Do so only in cases that make a lot of sense.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnes_filtered <- nes %>% # grab the nes_subset dataset...\n    filter(\n        race == \"White\" # ...and filter it to include only white respondents\n    )\n\nsummary(nes_filtered$race) #... we should only see one type of respondent here\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n          White           Black        Hispanic           Asian Native American \n            863               0               0               0               0 \n          Mixed           Other  Middle Eastern \n              0               0               0 \n```\n:::\n:::\n\n\n4. `mutate()`: for when you need to make a new variable out of an old one through transforming it\n\nPerhaps the most common thing we have to do as analysts is make new variables out of old ones. There are a variety of circumstances that would necessitate this. One example might be to make a log transformation of a variable like GDP Per Capita. Another example might be that you want to take a variable that has multiple categories and convert it into two (This is often referred to as data collapsing. I often don't recommend you do this, but there are some circumstances where you may need to to.), or you might need to reorder the values of a variable to make more logical sense.\n\nLet's do two examples. In the first example, let's perform a log transformation on the `gdppc` variable in the `world` dataset and store it into a new column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld_clean <- world %>% # with the world dataset...\n    mutate( # ...mutate an existing variable to make a new one...\n        log_gdppc = log(gdppc) # use the log function to take the log of gdppc and call the result log_gdppc\n    )\n\nprint(\n    paste(\"Old gdppc\", mean(world_clean$gdppc, na.rm = TRUE))\n    )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Old gdppc 16326.7806034642\"\n```\n:::\n\n```{.r .cell-code}\nprint(\n    paste(\"Log transformed gdppc\", mean(world_clean$log_gdppc, na.rm = TRUE))\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Log transformed gdppc 9.07144298877904\"\n```\n:::\n:::\n\n\nAnother example is that we want to do more hands on adjusting of the values that a variable takes on based on an existing variable in our dataset. So in this case we will use the `case_when()` function *inside* the `mutate()` function.\n\nSay that we are looking at the `nes` dataset and want to examine whether someone voted for Obama or not. In this case, you don't care who they voted for besides Obama, just whether they did or didn't. You look at the `vote12` variable in the `nes` dataset and it is close to what you want, but not *quite* what you are looking for:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(nes$vote12) # get understanding of vote12\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Mitt Romney Barack Obama Someone Else    Not asked \n         364          505           68          241 \n```\n:::\n:::\n\n\nWe can recode this variable to be two categories instead of the three!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnes_clean <- nes %>% # take the nes dataset...\n    mutate( # take an existing variable and make a new one with it\n        vote_clean = case_when( # make a new variable called vote_clean\n            vote12 == \"Mitt Romney\" ~ 0, # if Mitt Romney, code it to 0\n            vote12 == \"Barack Obama\" ~ 1, # if Barack Obama, code it to 1\n            vote12 == \"Someone Else\" ~ 0 # if Someone Else, code it to 0\n        )\n\n    )\n\nsummary(nes_clean$vote_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n  0.000   0.000   1.000   0.539   1.000   1.000     241 \n```\n:::\n:::\n\n\nIf we want to add labels to each of the values, we can do that with the built-in `factor()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnes_clean <- nes %>% # take the nes dataset...\n    mutate( # take an existing variable and make a new one with it\n        vote_clean = case_when( # create vote_clean column with the following values\n            vote12 == \"Mitt Romney\" ~ 0, # if Mitt Romney, code it to 0\n            vote12 == \"Barack Obama\" ~ 1, # if Barack Obama, code it to 1\n            vote12 == \"Someone Else\" ~ 0 # if Someone Else, code it to 0\n        ),\n        vote_clean = factor( # convert a variable to have value labels and call it vote_clean\n            vote_clean, # take the vote_clean variable I created above\n            labels = c(\n                \"Someone Else\", # give the first value the label Someone Else\n                \"Barack Obama\" # give the next value the label Obama\n            ),\n            ordered = TRUE # The order of the values matter (i.e., 0 = Someone Else, 1 = Obama)\n        )\n    )\nsummary(nes_clean$vote_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSomeone Else Barack Obama         NA's \n         432          505          241 \n```\n:::\n:::\n\n\n## Some final notes:\n\n- Datasets that we deal with are *rarely* clean. We often need to do a lot of adjusting to our data to make it usable.\n- As we have enough control to change our data, **we need to be extremely careful and thoughtful** about this step! You cannot just code any variable the way you want. This can be used to fake data and mislead people. What is a more common problem to look out for is people making mistakes in their code at this stage and this can lead to data that mislead people as well.\n- For an example R script for the cleaning that I did above, you can [go here](https://github.com/DamonCharlesRoberts/psci2075sp23.classes.damoncroberts.com/blob/main/examples/simple_data_cleaning.R). You can also check Dr. Philip's labs posted on Canvas.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}